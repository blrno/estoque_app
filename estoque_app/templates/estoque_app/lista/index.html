<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <title>Produtos</title>
        {% load static %}
        <link rel="stylesheet" href="{% static 'estoque_app/lista.css' %}">
    </head>
    <body>
        <div class = "main-title">
            <h1>Lista de Produtos</h1>
        </div>
        <div class="btn-box">
            {% if user.is_authenticated %}
                <a href="{% url 'estoque:adicionar' %}"
                   style="background-color: #feaf00"
                   class="btn">+ Adicionar Novo Produto</a>
                <form method="post" action="{% url 'users:logout' %}">
                    {% csrf_token %}
                    <button style="background-color: darkred;" type="submit">Logout</button>
                    {% if user.is_superuser %}
                        <a href="{% url 'users:register' %}">
                            <button style="background-color: #feaf00" type="button">Registrar</button>
                        </a>
                    {% endif %}
                </form>
            {% else %}
                <a href="{% url 'users:login' %}"
                   style="background-color: grey;
                          opacity:.3"
                   class="btn">+ Adicionar Novo Produto</a>
                <a href="{% url 'users:login' %}">
                    <button style="background-color: darkgreen;" type="button">Login</button>
                </a>
            {% endif %}
        </div>
        <hr>
    </hr>
    <table>
        <thead>
            <tr>
                <th>Nome</th>
                <th>Marca</th>
                <th>Valor</th>
                <th>Quantidade</th>
                <th>ID</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for produto in produtos %}
                <tr>
                    <td>{{ produto.nome }}</td>
                    <td>{{ produto.marca }}</td>
                    <td>{{ produto.valor }}</td>
                    <td>{{ produto.quantidade }}</td>
                    <td>{{ produto.id }}</td>
                    <td class="actions">
                        {% if user.is_authenticated %}
                            <a href="{% url 'estoque:editar' produto.id %}">
                                {% load static %}
                                <img src="{% static 'estoque_app/img/pen.svg' %}">
                            </a>
                            <a href="#"
                               onclick="openDeleteModal('{{ produto.id }}', '{{ produto.nome }}'); return false;">
                                {% load static %}
                                <img src="{% static 'estoque_app/img/trash.svg' %}">
                            </a>
                        {% else %}
                            <p>Login para habilitar ações</p>
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="6">Nenhum Produto cadastrado ainda.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    {% if user.is_authenticated %}
        <div id="deleteModal" class="modal" style="display:none;">
            <div class="modal-content">
                <h2>Atenção!</h2>
                <p>
                    Você tem certeza que deseja excluir <strong id="modalProdutoNome"></strong>?
                </p>
                <p>Esta ação não pode ser desfeita.</p>
                <form id="modalForm" method="POST">
                    {% csrf_token %}
                    <button class="del-btn" type="submit">Sim, excluir permanentemente</button>
                    <button type="button" onclick="closeModal()">Cancelar</button>
                </form>
            </div>
        </div>
    {% endif %}
    <script>
    function openDeleteModal(produtoId, produtoNome) {
        // Update product name inside modal
        document.getElementById('modalProdutoNome').textContent = produtoNome;

        // Update delete URL in the form
        const form = document.getElementById('modalForm');
        form.action = `/excluir/${produtoId}/`;
        // Show modal
        document.getElementById('deleteModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('deleteModal').style.display = 'none';
    }
    </script>
</body>
</html>
